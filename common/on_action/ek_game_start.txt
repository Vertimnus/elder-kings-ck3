# Called from code after history generation
# Empty scope
ek_on_game_start = {
	effect = {
		### Create a list with every culture. Because Paradox has every_faith, but not every_culture :(
		# Akaviri
		startup_culture_effect = { CULTURE = hakoshae }
		startup_culture_effect = { CULTURE = jaegi }
		startup_culture_effect = { CULTURE = tsaesci }
		# Aldmeris
		startup_culture_effect = { CULTURE = alinor }
		startup_culture_effect = { CULTURE = auridon }
		startup_culture_effect = { CULTURE = balfiera }
		startup_culture_effect = { CULTURE = corelanya }
		# Ayleid
		startup_culture_effect = { CULTURE = ayleid }
		startup_culture_effect = { CULTURE = barsaebic }
		startup_culture_effect = { CULTURE = hectahamic }
		# Bosmeris
		startup_culture_effect = { CULTURE = pactbosmer }
		startup_culture_effect = { CULTURE = civicbosmer }
		startup_culture_effect = { CULTURE = arenthian }
		# Breton
		startup_culture_effect = { CULTURE = glenumbran }
		startup_culture_effect = { CULTURE = northmen }
		startup_culture_effect = { CULTURE = iliac }
		startup_culture_effect = { CULTURE = bjoule }
		startup_culture_effect = { CULTURE = bretic }
		# Chimeris
		startup_culture_effect = { CULTURE = chimer }
		startup_culture_effect = { CULTURE = chimeriquey }
		startup_culture_effect = { CULTURE = cantemiric }
		# Dunmeris
		startup_culture_effect = { CULTURE = dunmer }
		startup_culture_effect = { CULTURE = ashlander }
		# Goblinken
		startup_culture_effect = { CULTURE = goblin }
		startup_culture_effect = { CULTURE = riekling }
		# Cyrodiilic
		startup_culture_effect = { CULTURE = colovian }
		startup_culture_effect = { CULTURE = nibenese }
		startup_culture_effect = { CULTURE = blackwood }
		startup_culture_effect = { CULTURE = heartlander }
		# Khajiiti
		startup_culture_effect = { CULTURE = pellitinian }
		startup_culture_effect = { CULTURE = anequinan }
		startup_culture_effect = { CULTURE = baandari }
		# Nedic
		startup_culture_effect = { CULTURE = reachfolk }
		startup_culture_effect = { CULTURE = kothringi }
		startup_culture_effect = { CULTURE = galen }
		startup_culture_effect = { CULTURE = keptu }
		startup_culture_effect = { CULTURE = duraki }
		startup_culture_effect = { CULTURE = kreath }
		startup_culture_effect = { CULTURE = perena }
		startup_culture_effect = { CULTURE = gemha }
		startup_culture_effect = { CULTURE = karth }
		startup_culture_effect = { CULTURE = nede }
		# Nordic
		startup_culture_effect = { CULTURE = eastmarcher }
		startup_culture_effect = { CULTURE = westmarcher }
		startup_culture_effect = { CULTURE = cyro_nord }
		startup_culture_effect = { CULTURE = atmoran }
		startup_culture_effect = { CULTURE = skaal }
		# Orsimer
		startup_culture_effect = { CULTURE = mountain_orc }
		startup_culture_effect = { CULTURE = iron_orc }
		startup_culture_effect = { CULTURE = wood_orc }
		# Yoku
		startup_culture_effect = { CULTURE = yokudan }
		startup_culture_effect = { CULTURE = forebear }
		startup_culture_effect = { CULTURE = crown }
		startup_culture_effect = { CULTURE = lhotunic }
		startup_culture_effect = { CULTURE = alikr }
		startup_culture_effect = { CULTURE = abecean }
		startup_culture_effect = { CULTURE = horsemen }
		# Argonian
		startup_culture_effect = { CULTURE = saxhleel }
		
		### Set which cultures are alive (have some territory)
		every_county = {
			culture = { save_scope_as = culture_to_save }
			add_to_global_variable_list = {
				name = culture_is_alive
				target = scope:culture_to_save
			}
		}
		
		### Nativity innovations
		## Build the list
		## Special
		set_culture_native_to = { REGION = nomadic CULTURE = culture:mountain_orc }
		set_culture_native_to = { REGION = nomadic CULTURE = culture:alikr }
		set_culture_native_to = { REGION = nomadic CULTURE = culture:horsemen }
		set_culture_native_to = { REGION = nomadic CULTURE = culture:baandari }
		set_culture_native_to = { REGION = nomadic CULTURE = culture:goblin }
		set_culture_native_to = { REGION = nomadic CULTURE = culture:bjoule }
		set_culture_native_to = { REGION = nomadic CULTURE = culture:tsaesci }
		## High Rock
		# Glenumbra
		set_culture_native_to = { REGION = glenumbra CULTURE = culture:glenumbran }
		set_culture_native_to = { REGION = glenumbra CULTURE = culture:balfiera }
		set_culture_native_to = { REGION = glenumbra CULTURE = culture:galen }
		# Rivenspire
		set_culture_native_to = { REGION = rivenspire CULTURE = culture:northmen }
		set_culture_native_to = { REGION = rivenspire CULTURE = culture:galen }
		# Stormhaven
		set_culture_native_to = { REGION = stormhaven CULTURE = culture:iliac }
		set_culture_native_to = { REGION = stormhaven CULTURE = culture:galen }
		# Wrothgar
		set_culture_native_to = { REGION = greater_wrothgar CULTURE = culture:bretic }
		set_culture_native_to = { REGION = greater_wrothgar CULTURE = culture:reachfolk }
		# Bangkorai
		set_culture_native_to = { REGION = bangkorai CULTURE = culture:iliac }
		set_culture_native_to = { REGION = bangkorai CULTURE = culture:duraki }
		set_culture_native_to = { REGION = bangkorai CULTURE = culture:forebear }
		## Hammerfell
		# Craglorn
		set_culture_native_to = { REGION = craglorn CULTURE = culture:duraki }
		set_culture_native_to = { REGION = craglorn CULTURE = culture:iron_orc }
		# Alikr
		set_culture_native_to = { REGION = alikr CULTURE = culture:crown }
		set_culture_native_to = { REGION = alikr CULTURE = culture:corelanya }
		# Brena
		set_culture_native_to = { REGION = brena CULTURE = culture:forebear }
		# Sunforge
		set_culture_native_to = { REGION = sunforge CULTURE = culture:forebear }
		set_culture_native_to = { REGION = sunforge CULTURE = culture:keptu }
		# Abecee
		set_culture_native_to = { REGION = abecee CULTURE = culture:abecean }
		set_culture_native_to = { REGION = abecee CULTURE = culture:corelanya }
		## Cyrodiil
		# Colovia
		set_culture_native_to = { REGION = colovia CULTURE = culture:colovian }
		set_culture_native_to = { REGION = colovia CULTURE = culture:cyro_nord }
		set_culture_native_to = { REGION = colovia CULTURE = culture:perena }
		# Heartlands
		set_culture_native_to = { REGION = heartlands CULTURE = culture:heartlander }
		set_culture_native_to = { REGION = heartlands CULTURE = culture:ayleid }
		# Nibenay
		set_culture_native_to = { REGION = nibenay CULTURE = culture:nibenese }
		set_culture_native_to = { REGION = nibenay CULTURE = culture:blackwood }
		set_culture_native_to = { REGION = nibenay CULTURE = culture:gemha }
		## Skyrim
		# Karth
		set_culture_native_to = { REGION = karth CULTURE = culture:reachfolk }
		# West Ghost
		set_culture_native_to = { REGION = west_ghost CULTURE = culture:westmarcher }
		# White River
		set_culture_native_to = { REGION = white_river CULTURE = culture:westmarcher }
		set_culture_native_to = { REGION = white_river CULTURE = culture:cyro_nord }
		set_culture_native_to = { REGION = white_river CULTURE = culture:kreath }
		# East Ghost
		set_culture_native_to = { REGION = east_ghost CULTURE = culture:eastmarcher }
		# Dark Water
		set_culture_native_to = { REGION = dark_water CULTURE = culture:eastmarcher }
		# Solstheim
		set_culture_native_to = { REGION = solstheim CULTURE = culture:skaal }
		set_culture_native_to = { REGION = solstheim CULTURE = culture:riekling }
		## Yokuda
		set_culture_native_to = { REGION = yokuda CULTURE = culture:yokudan }
		## Summerset Isles
		# Auridon
		set_culture_native_to = { REGION = auridon CULTURE = culture:auridon }
		# Summerset
		set_culture_native_to = { REGION = summerset CULTURE = culture:alinor }
		## Valenwood
		# Grahtwood
		set_culture_native_to = { REGION = grahtwood CULTURE = culture:pactbosmer }
		set_culture_native_to = { REGION = grahtwood CULTURE = culture:civicbosmer }
		set_culture_native_to = { REGION = grahtwood CULTURE = culture:wood_orc }
		set_culture_native_to = { REGION = grahtwood CULTURE = culture:hectahamic }
		# Greenshade
		set_culture_native_to = { REGION = greenshade CULTURE = culture:pactbosmer }
		set_culture_native_to = { REGION = greenshade CULTURE = culture:civicbosmer }
		# Malabal Tor
		set_culture_native_to = { REGION = malabal_tor CULTURE = culture:pactbosmer }
		set_culture_native_to = { REGION = malabal_tor CULTURE = culture:civicbosmer }
		set_culture_native_to = { REGION = malabal_tor CULTURE = culture:wood_orc }
		# Reaper's March
		set_culture_native_to = { REGION = reaper_march CULTURE = culture:arenthian }
		set_culture_native_to = { REGION = reaper_march CULTURE = culture:anequinan }
		## Elsweyr
		# Anequina
		set_culture_native_to = { REGION = anequina CULTURE = culture:anequinan }
		set_culture_native_to = { REGION = anequina CULTURE = culture:hakoshae }
		# Tenmar
		set_culture_native_to = { REGION = tenmar CULTURE = culture:pellitinian }
		# Pellitine
		set_culture_native_to = { REGION = pellitine CULTURE = culture:pellitinian }
		
		### Now that we know which cultures are native from which region, we can save every native culture in the county scope (genius, really)
		setup_county_native_cultures_link = yes
		
		### Some religious tweaks
		every_religion_global = {
			every_faith = {
				# Goes from a blanket view of the Daedric Princes to the sixteen specific ones
				faith_give_view_daedric_princes = yes
				
				# We need to save the leader of the Council of the Eight
				if = {
					limit = { has_doctrine = special_faith_group_council_of_the_eight_leader }
					set_global_variable = {
						name = leader_council_eight
						value = this
					}
					
					# Remember what is the current/former hof title
					set_global_variable = {
						name = leader_council_eight_former_title
						value = this.religious_head_title
					}
					
					# Destroy the current HoF title (is given back if someone usurps the leadership of the Council)
					religious_head_title = { save_scope_as = rel_head_title }
					religious_head = { destroy_title = scope:rel_head_title }
					
					# Set k_council_of_the_eight as its religious title
					set_religious_head_title = k_council_of_the_eight
				}
			}
		}
		
		### Holy Sites buildings
		## Due to how special buildings work, only one special building can be added per holding. So if faiths with different types of holy buildings share a holy site, it might be worth to check if it cannot be given a unique one
		every_religion_global = {
			every_faith = {
				limit = { has_doctrine_parameter = faith_uses_great_wyrd_tree }
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = great_wyrd_tree_01
						set_variable = { # If we want to change it later
							name = great_wyrd_tree
							value = yes
						}
					}
				}
			}
			every_faith = {
				limit = { has_doctrine_parameter = faith_uses_daedric_shrine }
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = daedric_shrine_01
						set_variable = { # If we want to change it later
							name = daedric_shrine
							value = yes
						}
					}
				}
			}
			every_faith = {
				limit = { has_doctrine_parameter = faith_uses_dragon_temple }
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = dragon_temple_01
						set_variable = { # If we want to change it later
							name = dragon_temple
							value = yes
						}
					}
				}
			}
			every_faith = {
				limit = { has_doctrine_parameter = faith_uses_grand_cathedral }
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = grand_cathedral_01
						set_variable = { # If we want to change it later
							name = grand_cathedral
							value = yes
						}
					}
				}
			}
			# Very generic
			every_faith = {
				every_holy_site = {
					limit = {
						title_province = {
							has_special_building_slot = no
						}
					}
					title_province = {
						add_special_building_slot = holy_site_other_grand_temple_01
						set_variable = { # If we want to change it later
							name = holy_site_other_grand_temple
							value = yes
						}
					}
				}
			}
		}
		
		### Innovations
		# Cultural & regional
		culture:alinor = { add_innovation = innovation_moonstone_armor }
		culture:auridon = { add_innovation = innovation_moonstone_armor }
		culture:balfiera = { add_innovation = innovation_moonstone_armor }
		
		culture:heartlander = { add_innovation = innovation_seat_of_empires }
		culture:nibenese = { add_innovation = innovation_seat_of_empires }
		culture:colovian = { add_innovation = innovation_seat_of_empires }
		
		culture:pactbosmer = { add_innovation = innovation_rite_of_theft }
		
		### Laws & stuff
		# If you're a pirate gov and are at least a duke, every duchy has an election
		every_ruler = {
			if = {
				limit = { has_government = pirate_government highest_held_title_tier >= tier_duchy }
				every_held_title = {
					limit = { tier >= tier_duchy }
					add_title_law = pirate_elective_succession_law
				}
			}
		}
		
		#############
		# BOOKMARKS #
		#############
		
		### FOUND THE ORDER OF THE EIGHT ###
		# Based in b_thalara
		title:b_thalara = { save_scope_as = ote_hq }
		scope:ote_hq.holder.top_liege = { save_scope_as = ote_patron }
		
		# A big copy paste of the decision effect, hopefully it'll work
		hidden_effect = {
			if = {
				limit = { NOT = { scope:ote_hq.holder = scope:ote_patron } }
				create_title_and_vassal_change = {
					type = leased_out
					save_scope_as = change
					add_claim_on_loss = no
				}
				scope:ote_hq = {
					change_title_holder_include_vassals = {
						holder = scope:ote_patron
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
			}
		}

		scope:ote_patron = {
			### Important, make sure that scope:base_char is defined and references the holy order patron
			scope:ote_patron = { save_scope_as = base_char }
			create_character = {
				template = holy_order_leader_character
				location = scope:ote_hq.title_province
				save_scope_as = leader
			}

			create_holy_order = {
				leader = scope:leader
				capital = scope:ote_hq
				save_scope_as = new_holy_order
			}

			### EK TODO: Make that work somehow
			scope:new_holy_order.title = { set_title_name = order_of_the_eight }
			
			hidden_effect = {
				scope:leader = {
					add_gold = 100 #So that they have some money to lend out
					add_piety_level = 2
					add_gold = holy_order_starting_gold
					every_courtier = {
						add_trait = order_member
					}
				}
			}
		}
		
		### 2E440 BOOKMARK ###
		## Assassination of Logrolf, the High King of Skyrim, by a lowly noble on the order of Svartr
		# The lowly noble then joined Western Skyrim and received lands and a wife for his services
		character:cursebraid_1000 = { save_scope_as = hk_svartr }
		character:bannertorn_100 = { save_scope_as = logrolf_murderer }
		character:flamehair_999 = { save_scope_as = hk_logrolf }
		
		if = {
			limit = {
				scope:logrolf_murderer = { is_alive = yes }
				scope:hk_svartr = { is_alive = yes }
			}
			
			# The noble first tried, without success, to kill Logrolf... Svartr knows it, and used the hook to force the noble to *again* try to kill his liege. Once the murder was successful, the two strong hooks cancelled each other out.
		
			# Svartr knows the murder attempt...
			scope:logrolf_murderer = {
				random_secret = {
					limit = {
						secret_type = secret_murder_attempt
						NOT = { is_known_by = scope:hk_svartr }
					}
					save_scope_as = logrolf_murder_attempt_secret
					
					# Svartr knows
					reveal_to = scope:hk_svartr
					# Used it to force the agent to kill his liege
					scope:hk_svartr = { blackmail_target_with_secret_effect = { SECRET = scope:logrolf_murder_attempt_secret TARGET = scope:logrolf_murderer } }
					# And then the two hooks cancelled each other
					scope:hk_svartr = { remove_hook = { target = scope:logrolf_murderer } }
				}
			}
		
			# And the lowly noble knows who killed Logrolf...
			scope:hk_svartr = {
				random_secret = {
					limit = {
						secret_type = secret_murder
						NOT = { is_known_by = scope:logrolf_murderer }
					}
					save_scope_as = logrolf_murder_proper_secret
					
					reveal_to = scope:logrolf_murderer
					# Mainly so Svartr can't be blackmailed *again*
					# The safe passage to Western Skyrim and the rewards can be counted as "blackmail"
					scope:logrolf_murderer = { blackmail_target_with_secret_effect = { SECRET = scope:logrolf_murder_proper_secret TARGET = scope:hk_svartr } }
					scope:logrolf_murderer = { remove_hook = { target = scope:hk_svartr } }
				}
			}
		}
	}
}