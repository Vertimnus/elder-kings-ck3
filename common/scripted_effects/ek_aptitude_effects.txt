# add_aptitude_skill = { VALUE = x }
# add_aptitude_skill = {
#     if = {
#         limit = { NOT = { exists = var:aptitude_base } }
#         #limit = { NOT = { has_variable = aptitude_base } }
#         set_variable = { name = aptitude_base value = 0 }
#     }
#     custom_description = {
#         text = add_aptitude_skill
#         value = $VALUE$
#         change_variable = { name = aptitude_base add = $VALUE$ }
#     }
#     if = {
#         limit = { var:aptitude_base < 0 }
#         set_variable = { name = aptitude_base value = 0 }
#     }
# }
add_aptitude_skill = {
    custom_description = {
        text = add_aptitude_skill
        value = $VALUE$
        if = {
            #limit = { NOT = { exists = var:aptitude_base } }
            limit = { NOT = { has_variable = aptitude_base } }
            set_variable = { name = aptitude_base value = $VALUE$ }
            if = { #this is nested to stop the error log having an aneurism if the variable doesn't exist
                limit = { $VALUE$ < 0 }
                set_variable = { name = aptitude_base value = 0 }
            }
        }
        else = {
            change_variable = { name = aptitude_base add = $VALUE$ }
            if = {
                limit = { var:aptitude_base < 0 }
                set_variable = { name = aptitude_base value = 0 }
            }
        }
    }
}
# add_magicka = {
#     if = {
#         limit = { NOT = { exists = var:magicka } }
#         #limit = { NOT = { has_variable = magicka } }
#         set_variable = { name = magicka value = 0 }
#     }
#     custom_description = {
#         text = add_magicka
#         value = $VALUE$
#         change_variable = { name = magicka add = $VALUE$ }
#     }
#     if = {
#         limit = { var:magicka > magicka_max }
#         set_variable = { name = magicka value = magicka_max }
#     }
# }
add_magicka = {
    custom_description = {
        text = add_magicka
        value = $VALUE$
        if = {
            #limit = { NOT = { exists = var:magicka } }
            limit = { NOT = { has_variable = magicka } }
            if = {
                limit = { NOT = { $VALUE$ = 0 } }
                set_variable = { name = magicka value = $VALUE$ }
                if = {
                    limit = { $VALUE$ > magicka_max }
                    set_variable = { name = magicka value = magicka_max }
                }
            }
        }
        else = {
            change_variable = { name = magicka add = $VALUE$ }
            if = {
                limit = { var:magicka > magicka_max }
                set_variable = { name = magicka value = magicka_max }
            }
        }
    }
}
add_quarterly_magicka_effect = {
    trigger_event = {
        on_action = add_monthly_magicka
        #days = 0
    }
    trigger_event = {
        on_action = add_monthly_magicka
        months = 1
    }
    trigger_event = {
        on_action = add_monthly_magicka
        months = 2
    }
}
add_monthly_magicka_effect = {
    add_magicka = { VALUE = magicka_monthly }
    every_general_councillor = {
        limit = {
            has_council_position = councillor_court_mage
            is_performing_council_task = task_court_mage_default
        }
        add_magicka = { VALUE = magicka_monthly }
    }
}

spell_caster_effect = {
    if = { #actual effect here
        limit = { has_variable = spell_cast_enabled }
        #add_magicka = { VALUE = -10 }
        #add_magicka = { VALUE = spell_$SPELL$_cost }
        var:spell_caster = { spell_$SPELL$_caster_effect = yes }
        var:spell_recipient = { spell_$SPELL$_castee_effect = yes }
        if = {
            limit = { var:spell_province = { has_variable = $SCHOOL$_province } }
            var:spell_recipient = { spell_$SPELL$_province_effect = yes }
        }
    }
    else = {
        hidden_effect = { #move to recipient and have is_valid and execute check for not variable clear on cast
            set_variable = { name = spell_selected value = flag:$SPELL$ }
            spell_reset_recipient = yes
            # var:spell_province = {
            #     if = {
            #         limit = { has_variable = $SCHOOL$_hostile }
            #         PREV = { set_variable = spell_is_hostile }
            #     }
            #     else = {
            #         PREV = { remove_variable = spell_is_hostile }
            #     }
            #     if = {
            #         limit = { has_variable = $SCHOOL$_province }
            #         PREV = { set_variable = spell_is_province }
            #     }
            #     else = {
            #         PREV = { remove_variable = spell_is_province }
            #     }
            # }
        }
        custom_label = spell_name_caster
        show_as_tooltip = { #effect here is for tooltip
            spell_$SPELL$_caster_effect = yes
        }
    }
}
spell_castee_effect = {
    custom_label = spell_name_castee
    spell_$SPELL$_castee_effect = yes
}
spell_province_effect = {
    #custom_label = spell_name_castee
    spell_$SPELL$_province_effect = yes
}
spell_reset_recipient = {
    if = {
        limit = { has_variable = spell_recipient_old }
        set_variable = { name = spell_recipient value = var:spell_recipient_old }
        remove_variable = spell_recipient_old
    }
}

spell_cleanup = {
    remove_variable = spell_selected
    remove_variable = spell_recipient
    remove_variable = spell_recipient_old
    remove_variable = spell_caster
    remove_variable = spell_cast_enabled
    remove_variable = spell_school
    clear_variable_list = spell_list
    remove_variable = spell_county
    clear_variable_list = spell_counties
    remove_variable = spell_province
    # remove_variable = spell_is_hostile
    # remove_variable = spell_is_province
}

# Alteration
spell_oakflesh_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_oakflesh }
}
spell_oakflesh_castee_effect = {
    add_aptitude_skill = { VALUE = 3 }
}
spell_wards_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_wards }
}
spell_wards_castee_effect = {
    add_aptitude_skill = { VALUE = 4 }
}
spell_wards_province_effect = {
    add_county_modifier = invested_in_province_modifier
}

# Conjuration
spell_summon_scamp_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_summon_scamp }
}
spell_summon_scamp_castee_effect = {
    add_aptitude_skill = { VALUE = 3 }
}

# Destruction
spell_flames_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_flames }
}
spell_flames_castee_effect = {
    add_aptitude_skill = { VALUE = 1 }
}
spell_frostbite_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_frostbite }
}
spell_frostbite_castee_effect = {
    add_aptitude_skill = { VALUE = 2 }
}
spell_sparks_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_sparks }
}
spell_sparks_castee_effect = {
    add_aptitude_skill = { VALUE = 3 }
}
spell_firestorm_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_firestorm }
}
spell_firestorm_castee_effect = {
    add_aptitude_skill = { VALUE = 4 }
}
spell_firestorm_province_effect = {
    add_county_modifier = occupation_modifier #modifier_spell_firestorm
}

# Illusion
spell_frenzy_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_frenzy }
}
spell_frenzy_castee_effect = {
    add_aptitude_skill = { VALUE = 3 }
}

# Restoration
spell_heal_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_heal }
}
spell_heal_castee_effect = {
    add_aptitude_skill = { VALUE = 3 }
}

# Necromancy
spell_raise_dead_caster_effect = {
    add_magicka = { VALUE = neg_spell_cost_raise_dead }
}
spell_raise_dead_castee_effect = {
    add_aptitude_skill = { VALUE = 3 }
}

# global spell lists up to 45 is fine, after some need to be skipped maybe if wasteland is invalid

add_spell = {
    add_to_global_variable_list = { name = spell_list_$SCHOOL$ target = THIS }
    if = {
        limit = { $HOSTILE$ = yes }
        set_variable = $SCHOOL$_hostile
    }
    else = {
        remove_variable = $SCHOOL$_hostile
    }
    if = {
        limit = { $PROVINCE$ = yes }
        set_variable = $SCHOOL$_province
    }
    else = {
        remove_variable = $SCHOOL$_province
    }
}

init_alteration = {
    clear_global_variable_list = spell_list_alteration
    province:1 = { add_spell = { SCHOOL = alteration HOSTILE = no PROVINCE = no } }
    province:2 = { add_spell = { SCHOOL = alteration HOSTILE = no PROVINCE = yes } }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:1 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:2 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:3 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:4 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:5 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:6 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:7 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:8 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:9 }
    # add_to_global_variable_list = { name = spell_list_alteration target = province:10 }
}
init_conjuration = {
    clear_global_variable_list = spell_list_conjuration
    province:1 = { add_spell = { SCHOOL = conjuration HOSTILE = no PROVINCE = no } }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:1 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:2 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:3 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:4 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:5 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:6 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:7 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:8 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:9 }
    # add_to_global_variable_list = { name = spell_list_conjuration target = province:10 }
}
init_destruction = {
    clear_global_variable_list = spell_list_destruction
    province:1 = { add_spell = { SCHOOL = destruction HOSTILE = yes PROVINCE = no } }
    province:2 = { add_spell = { SCHOOL = destruction HOSTILE = yes PROVINCE = no } }
    province:3 = { add_spell = { SCHOOL = destruction HOSTILE = yes PROVINCE = no } }
    province:4 = { add_spell = { SCHOOL = destruction HOSTILE = yes PROVINCE = yes } }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:1 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:2 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:3 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:4 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:5 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:6 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:7 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:8 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:9 }
    # add_to_global_variable_list = { name = spell_list_destruction target = province:10 }
}
init_illusion = {
    clear_global_variable_list = spell_list_illusion
    province:1 = { add_spell = { SCHOOL = illusion HOSTILE = yes PROVINCE = no } }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:1 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:2 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:3 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:4 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:5 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:6 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:7 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:8 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:9 }
    # add_to_global_variable_list = { name = spell_list_illusion target = province:10 }
}
init_restoration = {
    clear_global_variable_list = spell_list_restoration
    province:1 = { add_spell = { SCHOOL = restoration HOSTILE = no PROVINCE = no } }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:1 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:2 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:3 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:4 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:5 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:6 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:7 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:8 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:9 }
    # add_to_global_variable_list = { name = spell_list_restoration target = province:10 }
}
init_necromancy = {
    clear_global_variable_list = spell_list_necromancy
    province:1 = { add_spell = { SCHOOL = necromancy HOSTILE = no PROVINCE = no } }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:1 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:2 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:3 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:4 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:5 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:6 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:7 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:8 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:9 }
    # add_to_global_variable_list = { name = spell_list_necromancy target = province:10 }
}
init_spell_lists = {
    init_alteration = yes
    init_conjuration = yes
    init_destruction = yes
    init_illusion = yes
    init_restoration = yes
    init_necromancy = yes
}

spell_list_school = {
    clear_variable_list = spell_list
    every_in_global_list = { # ordered, based on spell level
        variable = spell_list_$SCHOOL$
        PREV = { add_to_variable_list = { name = spell_list target = PREV } }
    }
}