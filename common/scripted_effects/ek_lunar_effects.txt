
#day + year * months per year (12) * days per month (30) + offset % 32
#(day + (year * months * days) + offset) % 32
#(day + (year * months * days)) % offset -> both on 32 day orbit makes some combinations impossible
#offset = 3 for masser, -1 for secunda
# var:phase_[moon] = flag:[phase] is trigger


lunar_cycle_phase_masser = {
	if = {
		limit = { global_var:lunarphase_masser <= 5 }
		set_global_variable = { name = phase_masser value = flag:new }
	}
	else_if = {
		limit = { global_var:lunarphase_masser <= 11 }
		set_global_variable = { name = phase_masser value = flag:waxing }
	}
	else_if = {
		limit = { global_var:lunarphase_masser <= 17 }
		set_global_variable = { name = phase_masser value = flag:full }
	}
	else_if = {
		limit = { global_var:lunarphase_masser <= 23 }
		set_global_variable = { name = phase_masser value = flag:waning }
	}
}

lunar_cycle_phase_secunda = {
	if = {
		limit = { global_var:lunarphase_secunda <= 7 }
		set_global_variable = { name = phase_secunda value = flag:new }
	}
	else_if = {
		limit = { global_var:lunarphase_secunda <= 15 }
		set_global_variable = { name = phase_secunda value = flag:waxing }
	}
	else_if = {
		limit = { global_var:lunarphase_secunda <= 23 }
		set_global_variable = { name = phase_secunda value = flag:full }
	}
	else_if = {
		limit = { global_var:lunarphase_secunda <= 31 }
		set_global_variable = { name = phase_secunda value = flag:waning }
	}
}

lunar_cycle_start = {
	faith:imperial_cult = { #for some reason current_month requires a scope
		set_global_variable = {
			name = lunarphase_masser
			value = {
				add = lunar_cycle_start
				modulo = 24
			}
		}
		set_global_variable = {
			name = lunarphase_secunda
			value = {
				add = lunar_cycle_start
				modulo = 32
			}
		}
	}
	lunar_cycle_phase_masser = yes
	lunar_cycle_phase_secunda = yes
	trigger_event = {
		on_action = lunar_cycle_masser
		days = 3
	}
	trigger_event = {
		on_action = lunar_cycle_secunda
		days = 4
	}
}

lunar_cycle_masser_effect = {
	change_global_variable = { name = lunarphase_masser	add = 3 }
	change_global_variable = { name = lunarphase_masser modulo = 24 }
	lunar_cycle_phase_masser = yes
	trigger_event = {
		on_action = lunar_cycle_masser
		days = 3
	}
}

lunar_cycle_secunda_effect = {
	change_global_variable = { name = lunarphase_secunda add = 4 }
	change_global_variable = { name = lunarphase_secunda modulo = 32 }
	lunar_cycle_phase_secunda = yes
	trigger_event = {
		on_action = lunar_cycle_secunda
		days = 4
	}
}