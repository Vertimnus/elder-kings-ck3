
#day + year * months per year (12) * days per month (30) + offset % 32
#offset = 3 for masser, -1 for secunda
lunar_cycle_calculate = {

	set_variable = {
			name = lunarphase
			value = 0
	}
	
	set_variable = {
		name = lunaroffset
		value = -1
	}

	change_variable = {
		name = lunarphase
		add = current_day
	}
	change_variable = {
		name = lunarphase
		add = current_year
	}
	change_variable = {
		name = lunarphase
		multiply = 12
	}
	change_variable = {
		name = lunarphase
		multiply = 30
	}
	change_variable = {
		name = lunarphase
		add = $LUNAR_OFFSET$
	}
	change_variable = { name = lunarphase modulo = 32 } #Final result
}

lunar_cycle_phase_masser = {
	
	lunar_cycle_calculate = {
		LUNAR_OFFSET = 3
	}
	
	if = {
		limit = {
			lunarphase = 0 ##Full Moon
		}
		set_global_flag = masser_full 
	}
	
	else_if = {
		limit = {
			lunarphase = 16 ##New Moon
		}
		set_global_flag = masser_new
	}
	
	else_if = {
		limit = {
			lunarphase <= 5 ##Waning Gibbous
		}
		set_global_flag = masser_threewane
	}
	
	else_if = {
		limit = {
			lunarphase <= 10 ##Third Quarter
		}
		set_global_flag = masser_halfwane
	}
	
	else_if = {
		limit = {
			lunarphase <= 15 ##Waning Crescent
		}
		set_global_flag = masser_onewane
	}
	
	else_if = {
		limit = {
			lunarphase <= 22 ##Waxing Crescent
		}
		set_global_flag = masser_onewax
	}
	
	else_if = {
		limit = {
			lunarphase <= 28 ##First Quarter
		}
		set_global_flag = masser_halfwax
	}
	
	else_if = {
		limit = {
			lunarphase <= 31 ##Waxing Gibbous
		}
		set_global_flag = masser_threewax
	}
}

lunar_cycle_phase_secunda = {
	lunar_cycle_calculate = {
		LUNAR_OFFSET = -1
	}
	
	if = {
		limit = {
			lunarphase = 0 ##Full Moon
		}
		set_global_flag = secunda_full 
	}
	
	else_if = {
		limit = {
			lunarphase = 16 ##New Moon
		}
		set_global_flag = secunda_new


	else_if = {
		limit = {
			lunarphase <= 5 ##Waning Gibbous
		}
		set_global_flag = secunda_threewane
	}
	
	else_if = {
		limit = {
			lunarphase <= 10 ##Third Quarter
		}
		set_global_flag = secunda_halfwane
	}
	
	else_if = {
		limit = {
			lunarphase <= 15 ##Waning Crescent
		}
		set_global_flag = secunda_onewane
	}
	
	else_if = {
		limit = {
			lunarphase <= 22 ##Waxing Crescent
		}
		set_global_flag = secunda_onewax
	}
	
	else_if = {
		limit = {
			lunarphase <= 28 ##First Quarter
		}
		set_global_flag = secunda_halfwax
	}
	
	else_if = {
		limit = {
			lunarphase <= 31 ##Waxing Gibbous
		}
		set_global_flag = secunda_threewax
	}
}

