#Events dealing with the aftermath of the Attrebus vs Potentate war

namespace = ek_attrebus_potentate


########################
# Attrebus won, fallout
# 0001-00100
########################

### Attrebus assumes control of Cyrodiil, to deal with the fallout of the war
# Part 1: The Potentate
ek_attrebus_potentate.0001 = {
	title = ek_attrebus_potentate.0001.t
	
	desc = {
		desc = ek_attrebus_potentate.0001.desc
		first_valid = {
			triggered_desc = {
				trigger = { scope:potentate = { is_alive = yes } }
				desc = ek_attrebus_potentate.0001.desc.potentate_alive
			}
			triggered_desc = {
				trigger = { scope:potentate = { is_alive = no } }
				desc = ek_attrebus_potentate.0001.desc.potentate_dead
			}
		}
	}
	
	theme = war
	
	left_portrait = {
		character = scope:attrebus
		animation = war_over_win
	}
	
	right_portrait = {
		character = scope:potentate
		animation = prison_dungeon
	}
	
	immediate = {
		## There are some stuff to take care of before usurping the titles, so we do that here and not in the cb
		# We save all the vassals of the former Potentate
		scope:defender = {
			every_vassal_or_below = { add_to_list = potentate_vassals }
		}
		
		## Now we can usurp stuff
		hidden_effect = {
			scope:defender = { every_held_title = { add_to_temporary_list = titles_taken } }
			
			create_title_and_vassal_change = {
				type = conquest_claim
				save_scope_as = change
				add_claim_on_loss = yes
			}
			
			every_in_list = {
				list = titles_taken
				change_title_holder = {
					holder = scope:attacker
					change = scope:change
					take_baronies = yes
				}
			}

			resolve_title_and_vassal_change = scope:change
		}
		
		ROOT = {
			save_scope_as = attrebus
			destroy_title = title:e_colovian_estates
		}
		scope:defender = { save_scope_as = potentate }
	}

	# Off with the Snake's head!
	option = {
		trigger = { scope:potentate = { is_alive = yes } }
		
		name = ek_attrebus_potentate.0001.a
		
		add_dread = 10
		scope:potentate = { death = { killer = root death_reason = death_execution } }
		
		custom_tooltip = potentate_executed_elder_council_tooltip
		add_character_flag = attrebus_v_potentate_1_executed_potentate
	}

	# Throw him in the dungeon and throw the key!
	option = {
		trigger = { scope:potentate = { is_alive = yes } }
		
		name = ek_attrebus_potentate.0001.b
		
		imprison = { target = scope:potentate }
		
		add_character_flag = attrebus_v_potentate_1_imprisoned_potentate
	}
	
	# Banish him!
	option = {
		trigger = { scope:potentate = { is_alive = yes } }
		
		name = ek_attrebus_potentate.0001.c
		
		scope:potentate = { banish = yes }
		
		add_character_flag = attrebus_v_potentate_1_banished_potentate
	}
	
	# He ded
	option = {
		trigger = { scope:potentate = { is_alive = no } }
		
		name = ek_attrebus_potentate.0001.d
		
		add_character_flag = attrebus_v_potentate_1_dead_potentate
	}
	
	after = {
		every_player = {
			# limit = { NOT = { this = scope:attrebus } }
			trigger_event = {
				id = ek_attrebus_potentate.0002
				days = 1
			}
		}
		
		# Part 2: The Akaviri lords in Cyrodiil
		trigger_event = {
			id = ek_attrebus_potentate.0003
			days = 7
		}
	}
}

# People get the news
ek_attrebus_potentate.0002 = {
	title = ek_attrebus_potentate.0001.t
	
	desc = {
		desc = ek_attrebus_potentate.0002.desc
		first_valid = {
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_1_executed_potentate } }
				desc = ek_attrebus_potentate.0002.desc.potentate_executed
			}
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_1_imprisoned_potentate } }
				desc = ek_attrebus_potentate.0002.desc.potentate_imprisoned
			}
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_1_banished_potentate } }
				desc = ek_attrebus_potentate.0002.desc.potentate_banished
			}
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_1_dead_potentate } }
				desc = ek_attrebus_potentate.0002.desc.potentate_dead
			}
		}
	}
	
	theme = crown
	override_background = {
		event_background = dungeon
	}
	
	left_portrait = {
		character = scope:attrebus
		animation = war_over_win
	}
	
	right_portrait = {
		character = scope:potentate
		animation = prison_dungeon
	}

	immediate = {
		play_music_cue = mx_cue_murder
	}

	option = {
		name = ek_attrebus_potentate.0002.a
	}
}

# Part 2: The Akaviri lords in Cyrodiil
ek_attrebus_potentate.0003 = {
	title = ek_attrebus_potentate.0003.t
	
	desc = {
		desc = ek_attrebus_potentate.0003.desc
		first_valid = {
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_1_executed_potentate } }
				desc = ek_attrebus_potentate.0003.desc.potentate_executed
			}
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_1_imprisoned_potentate } }
				desc = ek_attrebus_potentate.0003.desc.potentate_imprisoned
			}
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_1_banished_potentate } }
				desc = ek_attrebus_potentate.0003.desc.potentate_banished
			}
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_1_dead_potentate } }
				desc = ek_attrebus_potentate.0003.desc.potentate_dead
			}
		}
	}
	
	theme = crown
	
	left_portrait = {
		character = scope:attrebus
		animation = war_over_win
	}
	
	right_portrait = {
		character = scope:akaviri_vassal
		animation = disbelief
	}

	immediate = {
		random_vassal_or_below = {
			limit = {
				this.culture = culture:tsaesci
			}
			save_scope_as = akaviri_vassal
		}
	}

	# Banish the lords, and brand those who dare stay here as criminals!
	option = {
		name = ek_attrebus_potentate.0003.a
		
		custom_tooltip = tsaesci_rulers_leave_criminal_tooltip
		custom_tooltip = tsaesci_rulers_leave_development_culture_convert_tooltip
		custom_tooltip = tsaesci_rulers_leave_future_counties_ban_tooltip
		
		### EK TODO: Just that
		
		every_held_title = {
			limit = { tier = tier_county culture = culture:tsaesci }
			change_development_progress_with_overflow = half_development
			set_county_culture = root.culture
		}
		
		add_character_flag = attrebus_v_potentate_2_exile
		add_character_flag = will_uphold_attrebus_tsaesci_exile # Obviously
		
		### EK TODO: Decision or event if a new ruler comes into power in Cyrodiil to enforce the ban
		
		custom_tooltip = tsaesci_rulers_leave_elder_council_tooltip
		add_character_flag = attrebus_tsaesci_rulers_exiled
	}
	
	# Force them to kneel!
	option = {
		name = ek_attrebus_potentate.0003.b
		
		# Change all the Akaviri vassals feudal contract: Up the taxes and levies, and remove any advantageous (for them) special rights
		every_vassal = {
			limit = {
				this.culture = culture:tsaesci
				vassal_contract_has_modifiable_obligations = yes
			}
			show_as_tooltip = {
				vassal_contract_increase_obligation_level = feudal_government_taxes
				vassal_contract_increase_obligation_level = feudal_government_levies
				
				custom_tooltip = remove_all_special_contract_tooltip
				
				hidden_tooltip = {
					vassal_contract_set_obligation_level = { type = special_contract level = special_contract_none }
					vassal_contract_set_obligation_level = { type = religious_rights level = religious_rights_none }
					vassal_contract_set_obligation_level = { type = fortification_rights level = fortification_rights_none }
					vassal_contract_set_obligation_level = { type = coinage_rights level = coinage_rights_none }
					vassal_contract_set_obligation_level = { type = war_declaration_rights level = war_declaration_rights_default }
					vassal_contract_set_obligation_level = { type = council_rights level = council_rights_none }
					vassal_contract_set_obligation_level = { type = title_revocation_rights_default level = special_contract_none }
				}
			}
		}
		
		add_character_flag = attrebus_v_potentate_2_kneel
	}
	
	# They should not be condemned for the crimes of the Potentate
	option = {
		name = ek_attrebus_potentate.0003.c
		
		custom_tooltip = tsaesci_rulers_reform_potentate_tooltip
		
		add_character_flag = attrebus_v_potentate_2_let
	}
	
	after = {
		every_vassal_or_below = {
			trigger_event = {
				id = ek_attrebus_potentate.0004
				days = 1
			}
		}
		
		# Part 3: The Temple District
		trigger_event = {
			id = ek_attrebus_potentate.0005
			days = 7
		}
	}
}

# The vassals get the news ...
ek_attrebus_potentate.0004 = {
	title = ek_attrebus_potentate.0003.t
	
	desc = {
		first_valid = {
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_2_exile } }
				desc = ek_attrebus_potentate.0004.desc.tsaesci_exile
			}
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_2_kneel } }
				desc = ek_attrebus_potentate.0004.desc.tsaesci_kneel
			}
			triggered_desc = {
				trigger = { scope:attrebus = { has_character_flag = attrebus_v_potentate_2_let } }
				desc = ek_attrebus_potentate.0004.desc.tsaesci_let
			}
		}
	}
	
	theme = crown
	
	left_portrait = {
		character = scope:attrebus
		animation = war_over_win
	}
	
	# Enforce the ban too!
	option = {
		trigger = {
			NOT = { culture = culture:tsaesci }
			scope:attrebus = { has_character_flag = attrebus_v_potentate_2_exile }
		}
		name = ek_attrebus_potentate.0004.a
		
		if = {
			limit = { scope:attrebus = { has_character_flag = attrebus_v_potentate_2_exile } }
			every_held_title = {
				limit = { tier = tier_county culture = culture:tsaesci }
				change_development_progress_with_overflow = half_development
				set_county_culture = root.culture
			}
		}
		
		### EK TODO: Just that
		custom_tooltip = tsaesci_rulers_leave_future_counties_ban_tooltip
		add_character_flag = will_uphold_attrebus_tsaesci_exile # Obviously
	}
	
	# Protect our Akaviri population
	option = {
		trigger = {
			NOT = { culture = culture:tsaesci }
			scope:attrebus = { has_character_flag = attrebus_v_potentate_2_exile }
		}
		name = ek_attrebus_potentate.0004.b
		
		custom_tooltip = tsaesci_rulers_refuse_enforce_ban_tooltip
	}
	
	# Cyrodiil is too dangerous, we have to leave
	option = {
		trigger = {
			culture = culture:tsaesci
			scope:attrebus = { has_character_flag = attrebus_v_potentate_2_exile }
		}
		name = ek_attrebus_potentate.0004.c
		
		# Get them couped
		random_in_global_list = {
			variable = culture_is_alive
			
			limit = { culture_group = culture_group:cyrodiilic_group }
			
			save_scope_as = culture_coup
		}
		
		every_held_title = {
			limit = { tier = tier_county culture = culture:tsaesci }
			change_development_progress_with_overflow = half_development
			set_county_culture = scope:culture_coup
		}
		
		custom_tooltip = tsaesci_rulers_get_exiled_tooltip
		custom_tooltip = tsaesci_rulers_game_over_tooltip
		
		create_character = {
			location = capital_province
			template = new_commander_character
			faith = faith:imperial_cult
			culture = scope:culture_coup
			save_scope_as = title_recipient
			gender_female_chance = {
				if = {
					limit = { scope:the_faith = { has_doctrine = doctrine_gender_male_dominated } }
					add = 0
				}
				else_if = {
					limit = { scope:the_faith = { has_doctrine = doctrine_gender_female_dominated } }
					add = 100
				}
				else = {
					add = 50
				}
			}
		}
		
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
			add_claim_on_loss = no
		}
		
		# Let's do this
		every_held_title = {
			change_title_holder = {
				holder = scope:title_recipient
				change = scope:change
			}
		}
		resolve_title_and_vassal_change = scope:change
	}
	
	# We are here to stay!
	option = {
		trigger = {
			culture = culture:tsaesci
			scope:attrebus = { has_character_flag = attrebus_v_potentate_2_exile }
		}
		name = ek_attrebus_potentate.0004.d
		
		# They're criminals
		scope:attrebus = {
			add_opinion = {
				target = root
				modifier = treachery_opinion
			}
		}
	}
	
	# So be it
	option = {
		trigger = {
			NOT = { culture = culture:tsaesci }
			NOT = { scope:attrebus = { has_character_flag = attrebus_v_potentate_2_exile } }
		}
		name = ek_attrebus_potentate.0004.e
	}
	
	# It could have been worse...
	option = {
		trigger = {
			culture = culture:tsaesci
			scope:attrebus = { has_character_flag = attrebus_v_potentate_2_kneel }
		}
		name = ek_attrebus_potentate.0004.f
		
		vassal_contract_increase_obligation_level = feudal_government_taxes
		vassal_contract_increase_obligation_level = feudal_government_levies
		
		vassal_contract_set_obligation_level = { type = special_contract level = special_contract_none }
		vassal_contract_set_obligation_level = { type = religious_rights level = religious_rights_none }
		vassal_contract_set_obligation_level = { type = fortification_rights level = fortification_rights_none }
		vassal_contract_set_obligation_level = { type = coinage_rights level = coinage_rights_none }
		vassal_contract_set_obligation_level = { type = war_declaration_rights level = war_declaration_rights_default }
		vassal_contract_set_obligation_level = { type = council_rights level = council_rights_none }
		vassal_contract_set_obligation_level = { type = title_revocation_rights_default level = special_contract_none }
	}
	
	# Let us put all of this behind
	option = {
		trigger = {
			culture = culture:tsaesci
			scope:attrebus = { has_character_flag = attrebus_v_potentate_2_let }
		}
		name = ek_attrebus_potentate.0004.g
	}
}

# Part 3: The Temple District
ek_attrebus_potentate.0005 = {
	title = ek_attrebus_potentate.0005.t
	
	desc = ek_attrebus_potentate.0005.desc
	
	theme = crown
	
	left_portrait = {
		character = scope:militant_priest
		animation = personality_bold
	}
	
	right_portrait = {
		character = scope:traditionalist_priest
		animation = personality_zealous
	}

	immediate = {
		random_ruler = {
			limit = {
				this.faith = root.faith
				has_government = theocracy_government
				this = character:valentian_99
			}
			alternative_limit = {
				this.faith = root.faith
				has_government = theocracy_government
			}
			save_scope_as = militant_priest
		}
		random_ruler = {
			limit = {
				this.faith = root.faith
				has_government = theocracy_government
				NOT = { this = scope:militant_priest }
			}
			save_scope_as = traditionalist_priest
		}
		
		title:b_temple_district = { save_scope_as = temple_district }
	}
	
	# Give the Temple District to a holy order
	option = {
		name = ek_attrebus_potentate.0005.a
		
		# We change the holding type here, and usurp it if needed
		hidden_tooltip = {
			scope:temple_district.title_province = { set_holding_type = castle_holding }
			
			if = {
				limit = { NOT = { scope:temple_district.holder = root } }
				create_title_and_vassal_change = {
					type = leased_out
					save_scope_as = change
					add_claim_on_loss = no
				}
				scope:temple_district = {
					change_title_holder_include_vassals = {
						holder = root
						change = scope:change
					}
				}
				resolve_title_and_vassal_change = scope:change
			}
		}
		
		# We create the holy order if needed
		if = {
			limit = { NOT = { faith = { any_faith_holy_order = { holy_order_patron = root } } } }
			scope:temple_district = { save_scope_as = ote_hq }
			scope:ote_hq.holder.top_liege = { save_scope_as = ote_patron }

			scope:ote_patron = {
				### Important, make sure that scope:base_char is defined and references the holy order patron
				scope:ote_patron = { save_scope_as = base_char }
				create_character = {
					template = holy_order_leader_character
					location = scope:ote_hq.title_province
					save_scope_as = leader
				}

				create_holy_order = {
					leader = scope:leader
					capital = scope:ote_hq
					save_scope_as = new_holy_order
				}
				
				hidden_effect = {
					scope:leader = {
						add_gold = 100 #So that they have some money to lend out
						add_piety_level = 2
						add_gold = holy_order_starting_gold
						every_courtier = {
							add_trait = order_member
						}
					}
				}
			}
			
			custom_tooltip = attrebus_leases_temple_district_transform_td_not_existing
		}
		
		# Or else we save it
		else = {
			faith = {
				random_faith_holy_order = {
					limit = { holy_order_patron = root }
					save_scope_as = order
				}
			}
			
			hidden_effect = {
				scope:temple_district = { lease_out_to = scope:order }
			}
			
			custom_tooltip = attrebus_leases_temple_district_transform_td
		}
		
		custom_tooltip = attrebus_leases_temple_district_unpopular
		custom_tooltip = attrebus_leases_temple_district_militaristic_faith
		add_piety = -500
		add_piety_level = -1
		root.faith = { change_fervor = -25 }
		
		custom_tooltip = attrebus_leases_temple_district_elder_council
		add_character_flag = attrebus_temple_district_leased
	}
	
	# Open up the Temple of the One to religious processions
	option = {
		name = ek_attrebus_potentate.0005.b
		
		add_piety = 250
		root.faith = { change_fervor = 10 }
		
		add_character_modifier = { modifier = attrebus_opened_temple_district years = 5 }
		title:d_imperial_isle = {
			every_in_de_jure_hierarchy = {
				limit = { tier = tier_county }
				add_county_modifier = { modifier = ic_attrebus_opened_temple_district years = 5 }
			}
		}
	}
	
	after = {
		# Part 4: The Nibenese lords
		trigger_event = {
			id = ek_attrebus_potentate.0007
			days = 7
		}
	}
}

# Part 4: The Nibenese lords
ek_attrebus_potentate.0007 = {
	title = ek_attrebus_potentate.0007.t
	
	desc = ek_attrebus_potentate.0007.desc
	
	theme = crown
	
	left_portrait = {
		character = scope:attrebus
		animation = personality_bold
	}
	
	right_portrait = {
		character = scope:nibenese_vassal
		animation = beg
	}

	immediate = {
		random_vassal = {
			limit = { culture = culture:nibenese }
			save_scope_as = nibenese_vassal
		}
	}
	
	# Traitors! They are all traitors!
	option = {
		name = ek_attrebus_potentate.0007.a
		
		add_tyranny = 25
		add_dread = 10
		
		# All the Nibenese lords in former Potentate land are branded traitors
		custom_tooltip = former_potentate_vassals_traitors_tooltip
		
		hidden_effect = {
			every_in_list = {
				list = potentate_vassals
				limit = {
					is_vassal_or_below_of = scope:attrebus
					primary_title.tier >= tier_county
				}
				save_temporary_scope_as = hook_target
				scope:attrebus = {
					add_opinion = {
						target = scope:hook_target
						modifier = treachery_opinion
					}
				}
			}
		}
		
		custom_tooltip = former_potentate_vassals_elder_council_tooltip
		add_character_flag = attrebus_nibenese_vassals_traitors
	}
	
	# Demand oaths of loyalty from all of them, or abdicate
	option = {
		name = ek_attrebus_potentate.0007.b
		
		# Get a weak hook on every former Potentate vassal_contract_has_modifiable_obligations
		custom_tooltip = former_potentate_vassals_hook_tooltip
		
		hidden_effect = {
			every_in_list = {
				list = potentate_vassals
				limit = {
					is_vassal_or_below_of = scope:attrebus
					primary_title.tier >= tier_county
				}
				save_temporary_scope_as = hook_target
				scope:attrebus = {
					add_hook_no_toast = {
						type = manipulation_hook
						target = scope:hook_target
					}
				}
			}
		}
	}
	
	# The Potentate has been destroyed. We have nothing to fear from them.
	option = {
		name = ek_attrebus_potentate.0007.c
		
		every_in_list = {
			list = potentate_vassals
			limit = {
				is_vassal_or_below_of = scope:attrebus
				primary_title.tier >= tier_county
			}
			add_opinion = {
				target = scope:attrebus
				modifier = grateful_opinion
				opinion = 15
			}
		}
	}
	
	after = {
		# Part 5: The debt to the Elder Council
		trigger_event = {
			id = ek_attrebus_potentate.0009
			days = 7
		}
	}
}

# Part 5: The debt to the Elder Council
ek_attrebus_potentate.0009 = {
	title = ek_attrebus_potentate.0009.t
	
	desc = ek_attrebus_potentate.0009.desc
	
	theme = stewardship_wealth_focus
	
	left_portrait = {
		character = scope:attrebus
		animation = worry
	}
	
	# Repay it in full yourself
	option = {
		trigger = { gold >= 1000 }
		name = ek_attrebus_potentate.0009.a
		
		show_as_unavailable = {
			gold < 1000
		}
		
		remove_short_term_gold = 1000
	}
	
	# Raise the taxes in Cyrodiil
	option = {
		name = ek_attrebus_potentate.0009.b
		
		remove_short_term_gold = 500
		add_prestige_level = -1
		
		every_realm_county = { add_county_modifier = { modifier = debt_ec_raised_taxes years = 5 } }
	}
	
	# Being free from the Potentate should be enough!
	option = {
		name = ek_attrebus_potentate.0009.c
		
		add_dread = 25
		
		custom_tooltip = attrebus_anger_elder_council
		add_character_flag = attrebus_refused_repay_ec
	}
	
	after = {
		# Part 6: Stepping down... unless?
		if = {
			limit = {
				NOT = {
					has_character_flag = attrebus_v_potentate_1_executed_potentate
					has_character_flag = attrebus_tsaesci_rulers_exiled
					has_character_flag = attrebus_temple_district_leased
					has_character_flag = attrebus_nibenese_vassals_traitors
					has_character_flag = attrebus_refused_repay_ec
				}
			}
			trigger_event = {
				id = ek_attrebus_potentate.0011
				days = 7
			}
		}
		
		# It's treason then.
		else = {
			trigger_event = {
				id = ek_attrebus_potentate.0013
				days = 7
			}
		}
	}
}

# Part 6: Stepping down, the Interregnum officially begins...
ek_attrebus_potentate.0011 = {
	title = ek_attrebus_potentate.0011.t
	
	desc = ek_attrebus_potentate.0011.desc
	
	theme = stewardship_wealth_focus
	
	left_portrait = {
		character = scope:attrebus
		animation = personality_content
	}
	
	# It has been an honour to serve Cyrodiil
	option = {
		name = ek_attrebus_potentate.00011.a
		
		### We create the vassal in the Imperial Isles (Imperial Commune)
		create_character = {
			location = title:c_imperial_city.title_province
			template = new_commander_character ### EK TODO: Not that (lol)
			faith = faith:imperial_cult
			culture = culture:heartlander
			save_scope_as = title_recipient
			gender_female_chance = {
				if = {
					limit = { scope:the_faith = { has_doctrine = doctrine_gender_male_dominated } }
					add = 0
				}
				else_if = {
					limit = { scope:the_faith = { has_doctrine = doctrine_gender_female_dominated } }
					add = 100
				}
				else = {
					add = 50
				}
			}
		}
		
		# We give them everything we own in k_heartlands (they usurp c_imperial_city if needed)
		title:k_heartlands = { add_to_list = titles_to_give }
		title:d_imperial_isle = { add_to_list = titles_to_give }
		title:c_imperial_city.title_province = { add_to_list = titles_to_give }
		every_held_title = {
			limit = { target_is_de_jure_liege_or_above = title:k_heartlands }
			add_to_list = titles_to_give
		}
		
		every_vassal = {
			limit = { capital_province = { kingdom = title:k_heartlands } }
			add_to_list = vassals_to_give
		}
		
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
			add_claim_on_loss = no
		}
		
		every_in_list = {
			list = titles_to_give
			change_title_holder = {
				holder = scope:title_recipient
				change = scope:change
				take_baronies = yes
			}
		}
		
		every_in_list = {
			list = vassals_to_give
			change_liege = {
				liege = scope:title_recipient
				change = scope:change
			}
		}
		
		resolve_title_and_vassal_change = scope:change
		
		# Then they become independent
		create_title_and_vassal_change = {
			type = independency
			save_scope_as = change
			add_claim_on_loss = yes
		}
		scope:title_recipient = {
			becomes_independent = {
				change = scope:change
			}
		}

		resolve_title_and_vassal_change = scope:change
		
		
		## Now we destroy some stuff
		destroy_title = title:e_cyrodiil
		
		primary_title = { save_scope_as = primary_title }
		
		### Vassals become independent
		every_vassal = {
			limit = { NOT = { this.primary_title = { target_is_de_jure_liege_or_above = scope:primary_title } } }
			create_title_and_vassal_change = {
				type = independency
				save_scope_as = change
				add_claim_on_loss = yes
			}
			becomes_independent = {
				change = scope:change
			}

			resolve_title_and_vassal_change = scope:change
		}
		
		### Any county that isn't de Jure under our primary title becomes independent
		every_held_title = {
			limit = {
				NOT = { this = scope:primary_title }
				NOT = { target_is_de_jure_liege_or_above = scope:primary_title }
			}
			add_to_list = titles_to_make_independent
		}
		
		every_in_list = {
			list = titles_to_make_independent
			save_scope_as = current_title
			
			create_character = {
				location = scope:current_title.current_title
				template = new_commander_character ### EK TODO: Not that (lol)
				faith = scope:current_title.faith
				culture = scope:current_title.culture
				save_scope_as = title_recipient
				gender_female_chance = {
					if = {
						limit = { scope:the_faith = { has_doctrine = doctrine_gender_male_dominated } }
						add = 0
					}
					else_if = {
						limit = { scope:the_faith = { has_doctrine = doctrine_gender_female_dominated } }
						add = 100
					}
					else = {
						add = 50
					}
				}
			}
			
			# We give them the title
			create_title_and_vassal_change = {
				type = independency
				save_scope_as = change
				add_claim_on_loss = no
			}

			change_title_holder = {
				holder = scope:title_recipient
				change = scope:change
				take_baronies = yes
			}
			
			# And we make them independent
			scope:title_recipient = {
				becomes_independent = {
					change = scope:change
				}
			}
			
			resolve_title_and_vassal_change = scope:change
		}
		
		custom_tooltip = imperial_commune_creation_tooltip
		custom_tooltip = rest_cyrodiil_indepndent_tooltip
		custom_tooltip = interregnum_starts_tooltip
	}
}

########################
# The Potentate won, fallout
# 0101-0200
########################

# The Potentate crushed Attrebus, time to deal with the aftermath
ek_attrebus_potentate.101 = {
	type = character_event
	title = ek_attrebus_potentate.101.t
	desc = ek_attrebus_potentate.101.desc
	theme = intrigue

	immediate = {
		play_music_cue = mx_cue_murder
	}

	option = {
		name = ek_attrebus_potentate.101.a
		add_dread = medium_dread_gain
	}

	option = {
		name = ek_attrebus_potentate.101.b
	}
}

# People are made aware of it
ek_attrebus_potentate.102 = {
	type = character_event
	title = ek_attrebus_potentate.102.t
	desc = ek_attrebus_potentate.102.desc
	theme = intrigue

	immediate = {
		play_music_cue = mx_cue_murder
	}

	option = {
		name = ek_attrebus_potentate.102.a
		add_dread = medium_dread_gain
	}

	option = {
		name = ek_attrebus_potentate.102.b
	}
}

########################
# Attrebus dies before the war can end!
# 0201-0300
########################
ek_attrebus_potentate.0201 = {
	type = character_event
	title = ek_attrebus_potentate.0201.t
	desc = ek_attrebus_potentate.0201.desc
	theme = intrigue
	
	trigger = {
		has_title = title:e_colovian_estates
	}
	
	immediate = {
		play_music_cue = mx_cue_murder
	}

	option = {
		name = ek_attrebus_potentate.0201.a
		
		# The Colovian Estates title is destroyed
		root = { destroy_title = title:e_colovian_estates }
		# You lose all non-de Jure vassals of Chorrol
		primary_title = { save_scope_as = primary_title }
		every_vassal = {
			limit = { NOT = { this.primary_title = { target_is_de_jure_liege_or_above = scope:primary_title } } }
			create_title_and_vassal_change = {
				type = independency
				save_scope_as = change
				add_claim_on_loss = yes
			}
			becomes_independent = {
				change = scope:change
			}

			resolve_title_and_vassal_change = scope:change
		}
	}
}